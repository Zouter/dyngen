<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Advanced: On scalability and runtime • dyngen</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="Advanced: On scalability and runtime">
<meta property="og:description" content="dyngen">
<meta property="og:image" content="https://dyngen.dynverse.org/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-7YGMM4L0JM"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-7YGMM4L0JM');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">dyngen</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/installation.html">Installation instructions</a>
    </li>
    <li>
      <a href="../../articles/getting_started.html">Getting started</a>
    </li>
    <li>
      <a href="../../articles/showcase_backbones.html">Showcase different backbones</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Advanced</li>
    <li>
      <a href="../../articles/advanced_topics/comparison_reference.html">Advanced: Comparison to reference dataset</a>
    </li>
    <li>
      <a href="../../articles/advanced_topics/constructing_backbone.html">Advanced: Constructing a custom backbone</a>
    </li>
    <li>
      <a href="../../articles/advanced_topics/run_dyngen_from_docker.html">Advanced: Running dyngen from a docker container</a>
    </li>
    <li>
      <a href="../../articles/advanced_topics/scalability_and_runtime.html">Advanced: On scalability and runtime</a>
    </li>
    <li>
      <a href="../../articles/advanced_topics/simulating_batch_effects.html">Advanced: Simulating batch effects</a>
    </li>
    <li>
      <a href="../../articles/advanced_topics/simulating_knockouts.html">Advanced: Simulating a knockout experiment</a>
    </li>
    <li>
      <a href="../../articles/advanced_topics/tweaking_parameters.html">Advanced: Tweaking parameters</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/dynverse/dyngen/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="scalability_and_runtime_files/header-attrs-2.8/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Advanced: On scalability and runtime</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dynverse/dyngen/blob/master/vignettes/advanced_topics/scalability_and_runtime.Rmd"><code>vignettes/advanced_topics/scalability_and_runtime.Rmd</code></a></small>
      <div class="hidden name"><code>scalability_and_runtime.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dyngen.dynverse.org">dyngen</a></span><span class="op">)</span></code></pre></div>
<!-- github markdown built using 
rmarkdown::render("vignettes/scalability_and_runtime.Rmd", output_format = rmarkdown::github_document())
-->
<p>In this vignette, we will take a look at the runtime of dyngen as the number of genes and the number of cells sampled is increased. We’ll be using the bifurcating cycle backbone which is well known for its beautiful 3D butterfly shape!</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dyngen.dynverse.org">dyngen</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>

<span class="va">save_dir</span> <span class="op">&lt;-</span> <span class="st">"scalability_and_runtime_runs"</span>
<span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.exists</a></span><span class="op">(</span><span class="va">save_dir</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span><span class="va">save_dir</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="va">backbone</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/list_backbones.html">backbone_bifurcating_cycle</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div id="initial-run" class="section level2">
<h2 class="hasAnchor">
<a href="#initial-run" class="anchor"></a>Initial run</h2>
<p>We’ll be running this simulation a few times, with different values for <code>num_cells</code> and <code>num_features</code> to assess the scalability of dyngen. An example of a resulting dyngen model is shown here.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">num_cells</span> <span class="op">&lt;-</span> <span class="fl">100</span>
<span class="va">num_features</span> <span class="op">&lt;-</span> <span class="fl">100</span>
<span class="va">num_tfs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">backbone</span><span class="op">$</span><span class="va">module_info</span><span class="op">)</span>
<span class="va">num_targets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="op">(</span><span class="va">num_features</span> <span class="op">-</span> <span class="va">num_tfs</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span>
<span class="va">num_hks</span> <span class="op">&lt;-</span> <span class="va">num_features</span> <span class="op">-</span> <span class="va">num_targets</span> <span class="op">-</span> <span class="va">num_tfs</span>

<span class="va">out</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="../../reference/initialise_model.html">initialise_model</a></span><span class="op">(</span>
    backbone <span class="op">=</span> <span class="va">backbone</span>,
    num_tfs <span class="op">=</span> <span class="va">num_tfs</span>,
    num_targets <span class="op">=</span> <span class="va">num_targets</span>,
    num_hks <span class="op">=</span> <span class="va">num_hks</span>,
    num_cells <span class="op">=</span> <span class="va">num_cells</span>,
    gold_standard_params <span class="op">=</span> <span class="fu"><a href="../../reference/generate_gold_standard.html">gold_standard_default</a></span><span class="op">(</span>
      census_interval <span class="op">=</span> <span class="fl">1</span>,
      tau <span class="op">=</span> <span class="fl">100</span><span class="op">/</span><span class="fl">3600</span>
    <span class="op">)</span>,
    simulation_params <span class="op">=</span> <span class="fu"><a href="../../reference/generate_cells.html">simulation_default</a></span><span class="op">(</span>
      census_interval <span class="op">=</span> <span class="fl">10</span>,
      ssa_algorithm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/GillespieSSA2/man/ssa_etl.html">ssa_etl</a></span><span class="op">(</span>tau <span class="op">=</span> <span class="fl">300</span><span class="op">/</span><span class="fl">3600</span><span class="op">)</span>,
      experiment_params <span class="op">=</span> <span class="fu"><a href="../../reference/generate_cells.html">simulation_type_wild_type</a></span><span class="op">(</span>
        num_simulations <span class="op">=</span> <span class="va">num_cells</span> <span class="op">/</span> <span class="fl">10</span>
      <span class="op">)</span>
    <span class="op">)</span>,
    verbose <span class="op">=</span> <span class="cn">FALSE</span>
  <span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../../reference/generate_dataset.html">generate_dataset</a></span><span class="op">(</span>make_plots <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">out</span><span class="op">$</span><span class="va">plot</span></code></pre></div>
<p><img src="scalability_and_runtime_files/figure-html/example-1.png" width="1920"></p>
<p>We tweaked some of the parameters by running this particular backbone once with <code>num_cells = 100</code> and <code>num_features = 100</code> and verifying that the new parameters still yield the desired outcome. The parameters we tweaked are:</p>
<ul>
<li>On average, 10 cells are sampled per simulation (e.g. <code>num_simulations = 100</code> and <code>num_cells = 1000</code>). You could increase this ratio to get a better cell count yield from a given set of simulations, but cells from the same simulation that are temporally close will have highly correlated expression profiles.</li>
<li>Increased time steps <code>tau</code>. This will make the Gillespie algorithm slightly faster but might result in unexpected artifacts in the simulated data.</li>
<li>
<code>census_interval</code> increased from 4 to 10. This will cause dyngen to store an expression profile only every 10 time units. Since the total simulation time is xxx, each simulation will result in yyy data points. Note that on average only 10 data points are sampled per simulation.</li>
</ul>
<p>For more information on parameter tuning, see the vignette ‘Advanced: tuning the simulation parameters’.</p>
</div>
<div id="timing-experiments" class="section level2">
<h2 class="hasAnchor">
<a href="#timing-experiments" class="anchor"></a>Timing experiments</h2>
<p>The simulations are run once with a large <code>num_features</code> and <code>num_cells</code>, a few times with varying <code>num_cells</code> and then once more with varying <code>num_features</code>. Every run is repeated three times in order to get a bit more stable time measurements. Since some of the simulations can take over 10 minutes, the timings results of the simulations are cached in the ‘scalability_and_runtime_runs’ folder.`</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">settings</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span>
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>num_cells <span class="op">=</span> <span class="fl">10000</span>, num_features <span class="op">=</span> <span class="fl">10000</span>, rep <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, <span class="co">#, rep = seq_len(3)),</span>
  <span class="fu">crossing</span><span class="op">(</span>
    num_cells <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">10000</span>, by <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span>,
    num_features <span class="op">=</span> <span class="fl">100</span>,
    rep <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span>
  <span class="op">)</span>,
  <span class="fu">crossing</span><span class="op">(</span>
    num_cells <span class="op">=</span> <span class="fl">100</span>,
    num_features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">10000</span>, by <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span>,
    rep <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">save_dir</span>, <span class="st">"/cells"</span>, <span class="va">num_cells</span>, <span class="st">"_feats"</span>, <span class="va">num_features</span>, <span class="st">"_rep"</span>, <span class="va">rep</span>, <span class="st">".rds"</span><span class="op">)</span><span class="op">)</span>

<span class="va">timings</span> <span class="op">&lt;-</span> <span class="fu">pmap_dfr</span><span class="op">(</span><span class="va">settings</span>, <span class="kw">function</span><span class="op">(</span><span class="va">num_cells</span>, <span class="va">num_features</span>, <span class="va">rep</span>, <span class="va">filename</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span><span class="op">(</span><span class="va">filename</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="va">rep</span><span class="op">)</span>
    
    <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Running num_cells: "</span>, <span class="va">num_cells</span>, <span class="st">", num_features: "</span>, <span class="va">num_features</span>, <span class="st">", rep: "</span>, <span class="va">rep</span>, <span class="st">"\n"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
    <span class="va">num_tfs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">backbone</span><span class="op">$</span><span class="va">module_info</span><span class="op">)</span>
    <span class="va">num_targets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="op">(</span><span class="va">num_features</span> <span class="op">-</span> <span class="va">num_tfs</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span>
    <span class="va">num_hks</span> <span class="op">&lt;-</span> <span class="va">num_features</span> <span class="op">-</span> <span class="va">num_targets</span> <span class="op">-</span> <span class="va">num_tfs</span>
    
    <span class="va">out</span> <span class="op">&lt;-</span> 
      <span class="fu"><a href="../../reference/initialise_model.html">initialise_model</a></span><span class="op">(</span>
        backbone <span class="op">=</span> <span class="va">backbone</span>,
        num_tfs <span class="op">=</span> <span class="va">num_tfs</span>,
        num_targets <span class="op">=</span> <span class="va">num_targets</span>,
        num_hks <span class="op">=</span> <span class="va">num_hks</span>,
        num_cells <span class="op">=</span> <span class="va">num_cells</span>,
        gold_standard_params <span class="op">=</span> <span class="fu"><a href="../../reference/generate_gold_standard.html">gold_standard_default</a></span><span class="op">(</span>
          census_interval <span class="op">=</span> <span class="fl">1</span>,
          tau <span class="op">=</span> <span class="fl">100</span><span class="op">/</span><span class="fl">3600</span>
        <span class="op">)</span>,
        simulation_params <span class="op">=</span> <span class="fu"><a href="../../reference/generate_cells.html">simulation_default</a></span><span class="op">(</span>
          census_interval <span class="op">=</span> <span class="fl">10</span>,
          ssa_algorithm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/GillespieSSA2/man/ssa_etl.html">ssa_etl</a></span><span class="op">(</span>tau <span class="op">=</span> <span class="fl">300</span><span class="op">/</span><span class="fl">3600</span><span class="op">)</span>,
          experiment_params <span class="op">=</span> <span class="fu"><a href="../../reference/generate_cells.html">simulation_type_wild_type</a></span><span class="op">(</span>
            num_simulations <span class="op">=</span> <span class="va">num_cells</span> <span class="op">/</span> <span class="fl">10</span>
          <span class="op">)</span>
        <span class="op">)</span>,
        verbose <span class="op">=</span> <span class="cn">FALSE</span>
      <span class="op">)</span> <span class="op">%&gt;%</span> 
      <span class="fu"><a href="../../reference/generate_dataset.html">generate_dataset</a></span><span class="op">(</span><span class="op">)</span>
    
    <span class="va">tim</span> <span class="op">&lt;-</span> 
      <span class="fu"><a href="../../reference/get_timings.html">get_timings</a></span><span class="op">(</span><span class="va">out</span><span class="op">$</span><span class="va">model</span><span class="op">)</span> <span class="op">%&gt;%</span> 
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="va">rep</span>, <span class="va">num_cells</span>, <span class="va">num_features</span><span class="op">)</span>
    
    <span class="fu">write_rds</span><span class="op">(</span><span class="va">tim</span>, <span class="va">filename</span>, compress <span class="op">=</span> <span class="st">"gz"</span><span class="op">)</span>
  <span class="op">}</span>
  
  <span class="fu">read_rds</span><span class="op">(</span><span class="va">filename</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>

<span class="va">timings_gr</span> <span class="op">&lt;-</span> 
  <span class="va">timings</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">group</span>, <span class="va">task</span>, <span class="va">num_cells</span>, <span class="va">num_features</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>time_elapsed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">time_elapsed</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span>

<span class="va">timings_sum</span> <span class="op">&lt;-</span>
  <span class="va">timings</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">num_cells</span>, <span class="va">num_features</span>, <span class="va">rep</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>time_elapsed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">time_elapsed</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span></code></pre></div>
</div>
<div id="simulate-a-large-dataset-10k-10k" class="section level2">
<h2 class="hasAnchor">
<a href="#simulate-a-large-dataset-10k-10k" class="anchor"></a>Simulate a large dataset (10k × 10k)</h2>
<p>Below is shown the timings of each of the steps in simulating a dyngen dataset containing 10’000 genes and 10’000 features. The total simulation time required is 1147 seconds, most of which is spent performing the simulations itself.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">timings0</span> <span class="op">&lt;-</span> 
  <span class="va">timings_gr</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">num_cells</span> <span class="op">==</span> <span class="fl">10000</span>, <span class="va">num_features</span> <span class="op">==</span> <span class="fl">10000</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_rev.html">fct_rev</a></span><span class="op">(</span><span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_inorder.html">fct_inorder</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">group</span>, <span class="st">": "</span>, <span class="va">task</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="fu">ggplot</span><span class="op">(</span><span class="va">timings0</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_bar</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">name</span>, y <span class="op">=</span> <span class="va">time_elapsed</span>, fill <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_fill_brewer</span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">coord_flip</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="st">"Time (s)"</span>, fill <span class="op">=</span> <span class="st">"dyngen stage"</span><span class="op">)</span></code></pre></div>
<p><img src="scalability_and_runtime_files/figure-html/bblego-1.png" width="768"></p>
</div>
<div id="increasing-the-number-of-cells" class="section level2">
<h2 class="hasAnchor">
<a href="#increasing-the-number-of-cells" class="anchor"></a>Increasing the number of cells</h2>
<p>By increasing the number of cells from 1000 to 10’000 whilst keeping the number of features fixed, we can get an idea of how the simulation time scales w.r.t. the number of cells.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">timings1</span> <span class="op">&lt;-</span> 
  <span class="va">timings_gr</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">num_features</span> <span class="op">==</span> <span class="fl">100</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">num_cells</span>, <span class="va">num_features</span>, <span class="va">group</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>time_elapsed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">time_elapsed</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span>

<span class="fu">ggplot</span><span class="op">(</span><span class="va">timings1</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_bar</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_inorder.html">fct_inorder</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">num_cells</span><span class="op">)</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">time_elapsed</span>, fill <span class="op">=</span> <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_inorder.html">fct_inorder</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span><span class="op">)</span>, stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_fill_brewer</span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Number of cells"</span>, y <span class="op">=</span> <span class="st">"Average time (s)"</span>, fill <span class="op">=</span> <span class="st">"dyngen step"</span><span class="op">)</span></code></pre></div>
<p><img src="scalability_and_runtime_files/figure-html/figure1-1.png" width="960"></p>
<p>It seems the execution time scales linearly w.r.t. the number of cells. This makes sense, because as the number of cells are increased, so do we increase the number of simulations made (which is not necessarily mandatory). Since the simulations are independent of each other and take up the most time, the execution time will scale linearly.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">timings_sum</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">num_features</span> <span class="op">==</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">num_cells</span>, <span class="va">time_elapsed</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_x_continuous</span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10000</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">300</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_abline</span><span class="op">(</span>intercept <span class="op">=</span> <span class="fl">22.097</span>, slope <span class="op">=</span> <span class="fl">0.0252</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Number of cells"</span>, y <span class="op">=</span> <span class="st">"Execution time (s)"</span><span class="op">)</span></code></pre></div>
<p><img src="scalability_and_runtime_files/figure-html/plot_timings_cell-1.png" width="768"></p>
</div>
<div id="increasing-the-number-of-features" class="section level2">
<h2 class="hasAnchor">
<a href="#increasing-the-number-of-features" class="anchor"></a>Increasing the number of features</h2>
<p>By increasing the number of features from 1000 to 10’000 whilst keeping the number of cells fixed, we can get an idea of how the simulation time scales w.r.t. the number of features</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">timings2</span> <span class="op">&lt;-</span> 
  <span class="va">timings_gr</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">num_cells</span> <span class="op">==</span> <span class="fl">100</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">num_cells</span>, <span class="va">num_features</span>, <span class="va">group</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>time_elapsed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">time_elapsed</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span>

<span class="fu">ggplot</span><span class="op">(</span><span class="va">timings2</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_bar</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_inorder.html">fct_inorder</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">num_features</span><span class="op">)</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">time_elapsed</span>, fill <span class="op">=</span> <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_inorder.html">fct_inorder</a></span><span class="op">(</span><span class="va">group</span><span class="op">)</span><span class="op">)</span>, stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_fill_brewer</span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Number of features"</span>, y <span class="op">=</span> <span class="st">"Average time (s)"</span>, fill <span class="op">=</span> <span class="st">"dyngen step"</span><span class="op">)</span></code></pre></div>
<p><img src="scalability_and_runtime_files/figure-html/figure2-1.png" width="960"></p>
<p>It seems the execution time also scales linearly w.r.t. the number of features. As more genes are added to the underlying gene regulatory network, the density of the graph doesn’t change, so it makes sense that the execution time also scales linearly w.r.t. the number of features.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">timings_sum</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">num_cells</span> <span class="op">==</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">num_features</span>, <span class="va">time_elapsed</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_x_continuous</span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10000</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">850</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_abline</span><span class="op">(</span>intercept <span class="op">=</span> <span class="fl">0.5481</span>, slope <span class="op">=</span> <span class="fl">0.07988</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Number of features"</span>, y <span class="op">=</span> <span class="st">"Execution time (s)"</span><span class="op">)</span></code></pre></div>
<p><img src="scalability_and_runtime_files/figure-html/plot_timings_feats-1.png" width="768"></p>
</div>
<div id="execution-platform" class="section level2">
<h2 class="hasAnchor">
<a href="#execution-platform" class="anchor"></a>Execution platform</h2>
<p>These timings were measured using 30 (out of 32) threads using a AMD Ryzen 9 5950X clocked at 3.4GHz.</p>
<p>Session info:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## R version 4.0.5 (2021-03-31)
## Platform: x86_64-redhat-linux-gnu (64-bit)
## Running under: Fedora 33 (Workstation Edition)
## 
## Matrix products: default
## BLAS/LAPACK: /usr/lib64/libflexiblas.so.3.0
## 
## locale:
##  [1] LC_CTYPE=en_GB.UTF-8       LC_NUMERIC=C              
##  [3] LC_TIME=en_GB.UTF-8        LC_COLLATE=en_GB.UTF-8    
##  [5] LC_MONETARY=en_GB.UTF-8    LC_MESSAGES=en_GB.UTF-8   
##  [7] LC_PAPER=en_GB.UTF-8       LC_NAME=C                 
##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            
## [11] LC_MEASUREMENT=en_GB.UTF-8 LC_IDENTIFICATION=C       
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] dyngen_1.0.2    forcats_0.5.1   stringr_1.4.0   dplyr_1.0.6    
##  [5] purrr_0.3.4     readr_1.4.0     tidyr_1.1.3     tibble_3.1.2   
##  [9] ggplot2_3.3.3   tidyverse_1.3.1
## 
## loaded via a namespace (and not attached):
##  [1] fs_1.5.0            dynutils_1.0.7      lubridate_1.7.10   
##  [4] RColorBrewer_1.1-2  httr_1.4.2          rprojroot_2.0.2    
##  [7] tools_4.0.5         backports_1.2.1     bslib_0.2.5.1      
## [10] irlba_2.3.3         utf8_1.2.1          R6_2.5.0           
## [13] DBI_1.1.1           colorspace_2.0-1    withr_2.4.2        
## [16] gridExtra_2.3       tidyselect_1.1.1    proxyC_0.2.0       
## [19] compiler_4.0.5      textshaping_0.3.4   cli_2.5.0          
## [22] rvest_1.0.0         RcppXPtrUtils_0.1.1 xml2_1.3.2         
## [25] desc_1.3.0          labeling_0.4.2      sass_0.4.0         
## [28] scales_1.1.1        pbapply_1.4-3       pkgdown_1.6.1      
## [31] systemfonts_1.0.2   digest_0.6.27       rmarkdown_2.8      
## [34] pkgconfig_2.0.3     htmltools_0.5.1.1   highr_0.9          
## [37] dbplyr_2.1.1        fastmap_1.1.0       rlang_0.4.11       
## [40] readxl_1.3.1        rstudioapi_0.13     jquerylib_0.1.4    
## [43] generics_0.1.0      farver_2.1.0        jsonlite_1.7.2     
## [46] magrittr_2.0.1      GillespieSSA2_0.2.8 patchwork_1.1.1    
## [49] Matrix_1.3-4        Rcpp_1.0.6          munsell_0.5.0      
## [52] fansi_0.5.0         viridis_0.6.1       lifecycle_1.0.0    
## [55] stringi_1.6.2       yaml_2.2.1          ggraph_2.0.5       
## [58] MASS_7.3-53.1       grid_4.0.5          parallel_4.0.5     
## [61] ggrepel_0.9.1       crayon_1.4.1        lattice_0.20-41    
## [64] graphlayouts_0.7.1  haven_2.4.1         hms_1.1.0          
## [67] knitr_1.33          pillar_1.6.1        igraph_1.2.6       
## [70] codetools_0.2-18    reprex_2.0.0        glue_1.4.2         
## [73] evaluate_0.14       remotes_2.4.0       RcppParallel_5.1.4 
## [76] modelr_0.1.8        vctrs_0.3.8         tweenr_1.0.2       
## [79] cellranger_1.1.0    gtable_0.3.0        polyclip_1.10-0    
## [82] assertthat_0.2.1    cachem_1.0.5        lmds_0.1.0         
## [85] xfun_0.23           ggforce_0.3.3       broom_0.7.6        
## [88] tidygraph_1.2.0     viridisLite_0.4.0   ragg_1.1.2         
## [91] memoise_2.0.0       ellipsis_0.3.2</code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Robrecht Cannoodt, Wouter Saelens.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
